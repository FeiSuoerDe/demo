### 地图
#### 星系地图(大地图)
在玩家创建新游戏时动态构建一个庞大而独特的宇宙区域。生成过程由随机种子（Random Seed）驱动，确保相同种子能生成完全相同的星域(不包括事件)。

---

# 星系地图生成机制文档

## 核心生成流程

1.  **初始化与种子设定:**
    *   玩家输入或系统自动生成一个随机种子 (`seed`)。
    *   游戏根据该种子初始化伪随机数生成器 (`Random`)，所有后续随机决策都基于此生成器，保证可复现性。


3.  **生成恒星系统骨架:**
    *   **数量:** 生成一定数量（通常 30-50+ 个(也可交给玩家定制)）的恒星系统位置点 (`StarSystem`)。系统间的距离有一定的随机分布，但会避免过于拥挤或稀疏。
    *   **位置分布:**
        *   核心星域内系统密度较高。
        *   星域边缘系统密度较低。
        *   系统位置会受到一定的“抖动” (`jitter`)，避免完美的网格排列。
    *   **恒星类型:** 为每个恒星系统分配一个主恒星类型（或双星/三星系统）。类型基于权重随机选择：
        *   常见：黄矮星 (Class G), 橙矮星 (Class K), 红矮星 (Class M)
        *   较少见：蓝白巨星 (Class B/A/F)， 白矮星 (White Dwarf)
        *   稀有：中子星 (Neutron Star), 黑洞 (Black Hole)
        *   特殊：无恒星系统 (Nebula Center, 仅特殊星云中心)
    *   **系统属性:** 为每个系统生成基础属性，如光照等级（影响行星温度范围）、危险等级（影响随机事件频率）等。

4.  **填充恒星系统内容:**
    *   对于每个恒星系统 (`StarSystem`)：
        *   **恒星放置:** 在系统中心放置主恒星（或双星/三星）。
        *   **行星带生成:**
            *   围绕恒星生成一系列“轨道带”（Orbital Bands）。每个带定义了距离恒星的近点和远点范围。
            *   轨道带类型决定了可以生成的天体类型（岩质行星、气态巨行星、小行星带等）和资源丰度。
            *   带类型示例：`Hot`, `Rocky`, `Habitable`, `Cold`, `Gas Giant`, `Asteroid Belt`, `Ice`, `Outer`。`Habitable` 带是生成宜居行星（类地、丛林、沙漠、海洋等）的关键区域。
        *   **天体生成:**
            *   在每个轨道带内，根据带类型和概率权重，生成一个或多个天体：
                *   **行星:** 确定行星类型 (Terran, Jungle, Desert, Arid, Barren, Water, Ice, Volcanic, Gas Giant, Cryovolcanic, Rocky Metallic, Rocky Unstable, Rocky Ice, Frozen, Toxic, Irradiated)。类型受轨道带、恒星类型（温度/光照）和随机性影响。
                *   **气态巨行星:** 通常单独占据一个带。
                *   **小行星带:** 生成小行星带实体 (`AsteroidBelt`)，包含大量小行星实体 (`Asteroid`)。小行星带本身可能含有矿藏。
                *   **小行星/冰晶簇:** 在非小行星带区域也可能随机生成小群的小行星或冰晶。
            *   **天体属性:**
                *   为每个天体生成精确的轨道参数（半径、偏心率、倾角、周期）。
                *   生成行星资源 (`conditions`)：大气、地表、矿产（Ore, Rare Ore, Volatiles）、有机物（Organics）、废墟（Ruins）、稀有物品（Rare Item）等。资源数量和类型有随机性和权重。
                *   生成行星特征 (`features`)：极端温度、恶劣天气、无大气层、低重力、高重力、可居住等。影响殖民难度和效果。
                *   为可殖民行星生成初始的 `hazard rating`（危险评级）。
        *   **跳跃点生成:**
            *   在系统边缘生成一个或多个跳跃点 (`JumpPoint`)，连接到其他恒星系统。构成星域的超空间航道网络。
            *   连接逻辑倾向于连接邻近系统，但也包含一些“长距离跳跃点”以增加星域连通性和探索感。
            *   每个系统通常有 1-4 个跳跃点。
        *   **特殊地点生成:**
            *   在系统内随机位置生成特殊地点 (`CustomEntity`)，如：
                *   研究站 (`Research Station`)
                *   传感器阵列 (`Sensor Array`)
                *   导航浮标 (`Nav Buoy`)
                *   通讯中继站 (`Comm Relay`)
                *   巨型结构废墟 (`[REDACTED]` / Domain-era Ruins)
                *   星云 (`Nebula`， 可能跨系统)
                *   超空间风暴 (`Hyperspace Storm`， 可能跨系统)
                *   余晖母舰 (`[REDACTED] Mothership`)
                *   余晖枢纽 (`[REDACTED] Nexus`)
            *   生成受系统危险等级、位置（核心/边缘）等因素影响概率。

5.  **势力分布与殖民地生成:**
    *   **势力初始位置:** 在核心星域内为各大主要势力（Hegemony, Sindrian Diktat, Persean League, Tri-Tachyon, Luddic Church, Luddic Path, Independents）分配起始恒星系统。通常每个势力占据一个或多个核心系统。
    *   **势力扩张:**
        *   在核心星域内，根据势力关系和权重，在未占据的系统内生成势力殖民地 (`Market`)。殖民地的行星通常是该系统中条件最好的（通常是 `Habitable` 带内的类地、丛林、沙漠、海洋等）。
        *   殖民地类型 (Orbital Station, Waystation, Fortress, Megaport, High Tech, Military Base, etc.) 根据行星类型和势力特点生成。
        *   为每个殖民地生成初始规模、产业、驻军、防御等。
    *   **边缘殖民地:** 在核心星域外的系统，也可能生成独立的边缘殖民地或小势力据点，条件通常较差。

6.  **星云与超空间地形:**
    *   **星云:** 在星域中生成一个或多个星云区域 (`Nebula`)。星云中心通常是特殊的“无恒星”系统。星云内部：
        *   能见度大幅降低。
        *   传感器范围大幅降低。
        *   超空间移动速度显著降低 (`burn level` 减少)。
        *   可能包含特殊星体（如中子星、黑洞）和 [REDACTED] 活动。
    *   **超空间风暴:** 在超空间 (`Hyperspace`) 中生成动态的、具有破坏性的风暴区域。接触风暴会造成船体损伤和停航 (`governed`)。风暴的位置、形状和强度是随机生成的，并随时间缓慢移动/变化。风暴密度在星域边缘和星云附近通常更高。

7.  **[REDACTED] 分布:**
    *   在非核心、通常是危险的系统（如含中子星、黑洞、星云内部、边缘系统）中生成 [REDACTED] (Remnant) 的基地 (`[REDACTED] Station`) 和巡逻队。
    *   生成 [REDACTED] 母舰 (`[REDACTED] Mothership`) 和 枢纽 (`[REDACTED] Nexus`) 作为特殊地点。
    *   其分布密度和强度通常随距离核心星域的增加而提高。

8.  **势力争夺点生成:**
    *   在战略位置（如连接重要区域的跳跃点附近、资源丰富的系统）生成“势力争夺点”。
    *   这些点初始可能被某个势力控制，或处于无主状态。
    *   控制这些点能提供战略优势（如探测范围加成、收入加成），并成为后期势力冲突的焦点。

9.  **最终处理与验证:**
    *   进行一些后处理，确保关键连接（如核心星域内部连通性）。
    *   检查是否有严重错误（如行星重叠）。
    *   将生成的星系数据（系统、天体、跳跃点、市场、地点等）序列化保存到存档中。

## 关键影响因素

*   **随机种子 (`seed`):** 最根本的决定因素，相同的种子生成完全相同的星域。
*   **配置文件参数:** 游戏文件（如 `settings.json`, `campaign` 目录下的各种 `.csv` 和 `.json`）中定义了大量的参数，控制着：
    *   星域大小、系统数量范围。
    *   各类恒星、行星、资源、特殊地点、[REDACTED] 出现的概率和权重。
    *   轨道带的数量、位置和类型分布。
    *   核心星域的范围和密度。
    *   势力初始位置和扩张规则。
    *   星云和风暴的生成规则。
    *   殖民地生成规则（规模、产业等）。
*   **位置:** 核心/边缘位置直接影响系统危险度、资源丰度、势力存在感、[REDACTED] 强度、特殊地点概率。
*   **恒星类型:** 决定光照和温度范围，直接影响行星类型分布（例如，蓝巨星附近难有宜居行星）。
*   **危险等级 (`system danger rating`):** 影响随机遭遇事件（海盗、[REDACTED]）的频率和强度，以及某些特殊地点（如大型废墟）的生成概率。

## 存档文件中的体现

生成的星系结构详细存储在玩家存档文件（通常是 `sector` 目录下的文件）中。主要包含：

*   `campaign.xml`: 存储全局信息，势力关系，时间，玩家状态等。
*   `star_systems.data`: 存储所有恒星系统的定义，包括位置、恒星、跳跃点列表。
*   `planets.data`: 存储所有行星/天体的详细信息，包括位置（轨道参数）、类型、资源 (`conditions`)、特征 (`features`)、所属市场等。
*   `markets.data`: 存储所有殖民地市场的详细信息，包括位置、规模、产业、库存、驻军、所属势力等。
*   `entities.data`: 存储所有特殊实体（研究站、传感器、废墟、星云、风暴、[REDACTED] 基地/母舰/枢纽、小行星带等）的信息。
*   `factions.data`: 存储各势力的详细信息。
*   `hyper.json`: (可能) 存储超空间地形信息，如星云、风暴的位置和形状。

## 注意事项


---
**补充说明:**

*   此文档侧重于**宏观星系地图**（超空间视角下的系统分布、连接）和**恒星系统内部结构**的生成。星系内具体的战场地图（行星环、小行星带内部结构等）是另一套独立的、在进入系统时按需生成的机制。
